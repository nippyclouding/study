<복습>
Servlet은 HTTP 요청, 응답 정보를 편리하게 관리할 수 있게 HttpServletRequest, HttpServletResponse를 제공한다.
1. HTTP 요청 시 WAS에서 request, response 객체를 생성 후 서블릿 객체를 호출한다. (request, response는 여러 개의 객체가 생성될 수 있다.)
2. 서블릿 객체를 통해 개발자는 request, response 객체에 HTTP 응답, 요청 정보를 편리하게 저장하거나 조회할 수 있다. (서블릿 객체는 싱글톤이다.)
3. WAS는 response 객체 속 내용으로 HTTP 응답 정보를 생성한다.

HttpServletRequest와 HttpServletResponse : WAS가 만들어낸 요청/응답 객체
@WebServlet("/example")
public class ExampleServlet extends HttpServlet {
    // 이 서블릿 인스턴스는 싱글톤으로 관리됨
}

Servlet 만으로 비즈니스, 뷰 구현 -> Jsp 만으로 비즈니스, 뷰 구현 -> MVC 패턴을 통해 컨트롤러 - 서블릿, 뷰 - Jsp를 나누어 구현 
한계 : 컨트롤러에서 공통 기능에 대해 중복이 많다. 
해결 : 프론트 컨트롤러 패턴 -> 컨트롤러 호출 전에 먼저 공통 기능을 처리



1. 컨트롤러 인터페이스 : 요청 객체, 응답 객체를 받아서 프로세싱하는 process 메서드
public interface ControllerV1 {
    void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException;
}

1-1. Memberform 뷰를 반환하는 컨트롤러
public class MemberFormControllerV1 implements ControllerV1{
    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //경로 지정, 요청 객체에 경로를 넣고 결과 반환
        String viewPath = "/WEB-INF/views/new-form.jsp";
        RequestDispatcher dispatcher =request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}

1-2. MemberList 뷰를 반환하는 컨트롤러
public class MemberListControllerV1 implements ControllerV1{
    private MemberRepository memberRepository = MemberRepository.getInstance();
    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        //DB에서 전체 회원 조회
        List<Member> members = memberRepository.findAll();
        //요청 객체에 전체 회원을 넣는다.
        request.setAttribute("members", members);

        //경로 지정, 요청 객체에 경로를 넣고 결과 반환
        String viewPath = "/WEB-INF/views/members.jsp";
        RequestDispatcher dispatcher =request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}

1-3. MemberSave 뷰를 반환하는 컨트롤러
public class MemberSaveControllerV1 implements ControllerV1{
    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        //요청 객체에서 username, age를 조회하여 Member 객체 생성, DB에 저장
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        //요청 객체에 새로 생성한 Member 객체를 넣는다.
        request.setAttribute("member", member);

        //경로 지정, 요청 객체에 경로를 넣고 결과 반환
        String viewPath = "/WEB-INF/views/save-result.jsp";
        RequestDispatcher dispatcher =request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}


2. 프론트 컨트롤러
- 모든 요청을 프론트 컨트롤러에서 받은 뒤 map에서 요청 URI에 해당하는 컨트롤러를 조회
- 컨트롤러의 process 메서드를 통해 뷰를 응답

@WebServlet(name=  "frontControllerServletV1", urlPatterns = "/front-controller/v1/*")
public class FrontControllerServletV1 extends HttpServlet {

    private Map<String, ControllerV1> controllerMap = new HashMap<>();

    //프론트 컨트롤러로 요청이 올 경우 jsp 경로를 key로, 경로에 해당하는 컨트롤러를 value로 설정하여 생성
    public FrontControllerServletV1() {
        controllerMap.put("/front-controller/v1/members/new-form", new MemberFormControllerV1());
        controllerMap.put("/front-controller/v1/members/save", new MemberSaveControllerV1());
        controllerMap.put("/front-controller/v1/members", new MemberListControllerV1());
    }

    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        //요청 객체 속 URI를 조회
        String requestURI = req.getRequestURI();
        //map에서 key인 String uri를 통해 value를 조회
        ControllerV1 controller = controllerMap.get(requestURI);

        //검증
        if(controller==null){
            resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }
        //검증 통과 시 컨트롤러의 process 메서드 수행
        controller.process(req,resp);
    }
}

